(()=>{var t={n:e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return t.d(s,{a:s}),s},d:(e,s)=>{for(var o in s)t.o(s,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:s[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e),t.d(e,{extend:()=>rt});const s=flarum.reg.get("core","forum/app");var o=t.n(s);const a=flarum.reg.get("core","forum/components/IndexSidebar");var i=t.n(a);const r=flarum.reg.get("core","common/extend"),n=flarum.reg.get("core","common/components/LinkButton");var l=t.n(n);const u=flarum.reg.get("core","common/extenders");var c=t.n(u);function h(t){return h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},h(t)}function d(t,e,s){return(e=function(t){var e=function(t){if("object"!=h(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var s=e.call(t,"string");if("object"!=h(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==h(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}const g=flarum.reg.get("core","common/components/Page");var f=t.n(g);const b=flarum.reg.get("core","common/helpers/listItems");var p=t.n(b);const v=flarum.reg.get("core","common/utils/ItemList");var y=t.n(v);const w=flarum.reg.get("core","common/components/LoadingIndicator");var I=t.n(w);const L=flarum.reg.get("core","common/utils/humanTime");var M=t.n(L);const x=flarum.reg.get("core","common/components/Icon");var A=t.n(x);const z=flarum.reg.get("core","forum/components/PageStructure");var N=t.n(z);const D=flarum.reg.get("core","common/Component");var S=t.n(D);const P=flarum.reg.get("core","common/components/Button");var k=t.n(P);const _=flarum.reg.get("core","common/components/Dropdown");var B=t.n(_);const G=flarum.reg.get("core","common/components/Tooltip");var O=t.n(G);const T={issue:{open:{icon:m("svg",{class:"icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:"16",height:"16"},m("path",{"fill-rule":"evenodd",d:"M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm9 3a1 1 0 11-2 0 1 1 0 012 0zm-.25-6.25a.75.75 0 00-1.5 0v3.5a.75.75 0 001.5 0v-3.5z"})),color:"#22863a"},closed:{icon:m("svg",{class:"icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:"16",height:"16"},m("path",{"fill-rule":"evenodd",d:"M1.5 8a6.5 6.5 0 0110.65-5.003.75.75 0 00.959-1.153 8 8 0 102.592 8.33.75.75 0 10-1.444-.407A6.5 6.5 0 011.5 8zM8 12a1 1 0 100-2 1 1 0 000 2zm0-8a.75.75 0 01.75.75v3.5a.75.75 0 11-1.5 0v-3.5A.75.75 0 018 4zm4.78 4.28l3-3a.75.75 0 00-1.06-1.06l-2.47 2.47-.97-.97a.749.749 0 10-1.06 1.06l1.5 1.5a.75.75 0 001.06 0z"})),color:"#cb2431"},merged:{icon:m("svg",{class:"icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:"16",height:"16"},m("path",{"fill-rule":"evenodd",d:"M1.5 8a6.5 6.5 0 0110.65-5.003.75.75 0 00.959-1.153 8 8 0 102.592 8.33.75.75 0 10-1.444-.407A6.5 6.5 0 011.5 8zM8 12a1 1 0 100-2 1 1 0 000 2zm0-8a.75.75 0 01.75.75v3.5a.75.75 0 11-1.5 0v-3.5A.75.75 0 018 4zm4.78 4.28l3-3a.75.75 0 00-1.06-1.06l-2.47 2.47-.97-.97a.749.749 0 10-1.06 1.06l1.5 1.5a.75.75 0 001.06 0z"})),color:"#6f42c1"}},pull:{open:{icon:m("svg",{class:"icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:"16",height:"16"},m("path",{"fill-rule":"evenodd",d:"M7.177 3.073L9.573.677A.25.25 0 0110 .854v4.792a.25.25 0 01-.427.177L7.177 3.427a.25.25 0 010-.354zM3.75 2.5a.75.75 0 100 1.5.75.75 0 000-1.5zm-2.25.75a2.25 2.25 0 113 2.122v5.256a2.251 2.251 0 11-1.5 0V5.372A2.25 2.25 0 011.5 3.25zM11 2.5h-1V4h1a1 1 0 011 1v5.628a2.251 2.251 0 101.5 0V5A2.5 2.5 0 0011 2.5zm1 10.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0zM3.75 12a.75.75 0 100 1.5.75.75 0 000-1.5z"})),color:"#22863a"},closed:{icon:m("svg",{class:"icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:"16",height:"16"},m("path",{"fill-rule":"evenodd",d:"M7.177 3.073L9.573.677A.25.25 0 0110 .854v4.792a.25.25 0 01-.427.177L7.177 3.427a.25.25 0 010-.354zM3.75 2.5a.75.75 0 100 1.5.75.75 0 000-1.5zm-2.25.75a2.25 2.25 0 113 2.122v5.256a2.251 2.251 0 11-1.5 0V5.372A2.25 2.25 0 011.5 3.25zM11 2.5h-1V4h1a1 1 0 011 1v5.628a2.251 2.251 0 101.5 0V5A2.5 2.5 0 0011 2.5zm1 10.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0zM3.75 12a.75.75 0 100 1.5.75.75 0 000-1.5z"})),color:"#cb2431"},merged:{icon:m("svg",{class:"icon",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:"16",height:"16"},m("path",{"fill-rule":"evenodd",d:"M5 3.254V3.25v.005a.75.75 0 110-.005v.004zm.45 1.9a2.25 2.25 0 10-1.95.218v5.256a2.25 2.25 0 101.5 0V7.123A5.735 5.735 0 009.25 9h1.378a2.251 2.251 0 100-1.5H9.25a4.25 4.25 0 01-3.8-2.346zM12.75 9a.75.75 0 100-1.5.75.75 0 000 1.5zm-8.5 4.5a.75.75 0 100-1.5.75.75 0 000 1.5z"})),color:"#6f42c1"}}},R=flarum.reg.get("sycho-uikit","common/components/ProgressBar");var V=t.n(R);const j=flarum.reg.get("sycho-uikit","common/components/LabelGroup");var C=t.n(j);const H=flarum.reg.get("sycho-uikit","common/components/Label");var U=t.n(H);const q=flarum.reg.get("flarum-tags","common/helpers/tagsLabel");var E=t.n(q);class F extends(S()){view(){const t=this.attrs.issue;return m("div",{class:"DiscussionListItem"},m("div",{class:"DiscussionListItem-content"},m("div",{class:"DiscussionListItem-author"},m(O(),{text:o().translator.trans("core.forum.discussion_list.started_text",{username:t.user().login,ago:M()(t.createdAt())}),position:"right"},m("a",{class:"DiscussionListItem-author-avatar",href:t.user().html_url},m("img",{class:"Avatar",loading:"lazy",src:t.user().avatar_url,alt:""}))),m("ul",{class:"DiscussionListItem-badges badges badges--packed"},p()(this.badgeItems(t).toArray()))),m("a",{href:t.htmlUrl(),class:"DiscussionListItem-main"},m("h2",{class:"DiscussionListItem-title"},t.title()),m("ul",{class:"DiscussionListItem-info"},p()(this.infoItems(t).toArray()))),m("div",{class:"DiscussionListItem-stats"},m("span",{class:"DiscussionListItem-stats-item DiscussionListItem-count"},m("span",{class:"DiscussionListItem-stats-item-icon"},m("i",{"aria-hidden":"true",class:"icon far fa-comment"})),m("span",{class:"DiscussionListItem-stats-item-label"},m("span",{"aria-hidden":"true"},t.comments()))))))}getTasks(){const t=(this.attrs.issue.body().match(/\r\n- \[ \]/g)||[]).length,e=(this.attrs.issue.body().match(/\r\n- \[x\]/g)||[]).length;return{current:e,total:e+t}}badgeItems(t){const e=new(y());let s="issue",o=t.state();return t.pullRequest()&&(s="pull",t.pullRequest().merged_at&&(o="merged")),"closed"===t.state()&&"completed"===t.stateReason()&&(o="merged"),o&&e.add("state",m("span",{className:"Badge GithubMilestone-Badge",style:{backgroundColor:T[s][o].color}},T[s][o].icon)),e}infoItems(t){const e=new(y());e.add("terminalPost",m("span",null,m(A(),{name:"far fa-clock"})," ",o().translator.trans("sycho-github-milestone.forum.last_updated",{time:M()(t.updatedAt())})));const s=this.getTasks();return s.total&&e.add("github-tasks",m("span",null,m(A(),{name:"fas fa-tasks"})," ",o().translator.trans("sycho-github-milestone.forum.tasks_done",{number:s.current,total:s.total}),m(V(),{progress:100*s.current/s.total,mini:!0}))),"flarum-tags"in flarum.extensions?e.add("tags",E()(t.labels().map((t=>({color:()=>"#"+t.color,name:()=>t.name,isChild:()=>!1,slug:()=>t.name,icon:()=>null}))))):e.add("github-labels",m(C(),null,t.labels().map((t=>m(U(),{color:t.color},t.name))))),e}}flarum.reg.add("sycho-github-milestone","forum/components/IssueListItem",F);const J=flarum.reg.get("core","common/components/InfoTile");var K=t.n(J);class Q extends(S()){constructor(){super(...arguments),d(this,"filters",{state:{options:["all","closed","open"]}})}oninit(t){super.oninit(t)}view(){let t=m(I(),null);this.attrs.state.isLoadingNext()||(t=m(k(),{className:"Button",onclick:()=>this.attrs.state.loadNext()},o().translator.trans("sycho-github-milestone.forum.load_more"))),this.attrs.state.hasNext()||this.attrs.state.isLoadingNext()||(t="");const e=[];return this.attrs.state.getAllItems().forEach((t=>{e.push(m("li",null,m(F,{issue:t})))})),m("div",{className:"GithubMilestone-issues"},m("div",{className:"IndexPage-toolbar"},m("ul",{className:"IndexPage-toolbar-view"},p()(this.viewItems().toArray())),m("ul",{className:"IndexPage-toolbar-action"},p()(this.actionItems().toArray()))),this.attrs.state.isLoading()?m(I(),null):m("div",{className:"GithubMilestone-issuesContainer DiscussionList DiscussionList--floatingTags"},e.length>0?m("ul",{className:"GithubMilestone-issuesList DiscussionList-discussions"},e):m(K(),{icon:"fas fa-check"},o().translator.trans("sycho-github-milestone.forum.empty_list")),m("div",{className:"DiscussionList-loadMore"},t)))}changeState(t){this.attrs.activeState(t),this.attrs.state.refreshParams({filter:{state:t}},1)}viewItems(){const t=new(y());return t.add("state",m(B(),{buttonClassName:"Button",label:o().translator.trans("sycho-github-milestone.forum.".concat(this.attrs.activeState()))},this.filters.state.options.map((t=>{const e=t===this.attrs.activeState();return m(k(),{icon:e?"fas fa-check":" ",onclick:this.changeState.bind(this,t),active:e},o().translator.trans("sycho-github-milestone.forum.".concat(t)))})))),t}actionItems(){return new(y())}}flarum.reg.add("sycho-github-milestone","forum/components/IssueList",Q);class W extends(S()){view(){const t=this.attrs.title,e=this.attrs.subtitle;return delete this.attrs.title,delete this.attrs.subtitle,this.attrs.className="Hero "+(this.attrs.className||""),m("header",this.attrs,m("div",{className:"container"},m("div",{className:"containerNarrow"},m("h2",{className:"Hero-title"},t),m("div",{className:"Hero-subtitle"},e))))}}flarum.reg.add("sycho-github-milestone","forum/components/Hero",W);const X=flarum.reg.get("core","common/states/PaginatedListState");var Y=t.n(X);class Z extends(Y()){get type(){return"github-issues"}constructor(t){void 0===t&&(t={}),super(t)}getAllItems(){return super.getAllItems()}}flarum.reg.add("sycho-github-milestone","forum/states/IssueListState",Z);const $=flarum.reg.get("core","common/utils/Stream");var tt=t.n($);class et extends(f()){constructor(){super(...arguments),d(this,"settings",{}),d(this,"milestone",void 0),d(this,"activeState",tt()(o().forum.attribute("sycho-github-milestone.default_filter")||"all"))}oninit(t){var e,s;super.oninit(t),this.state=new Z,this.settings={repository:{owner:null==(e=o().forum.attribute("sycho-github-milestone.repository"))?void 0:e.split("/")[0],name:null==(s=o().forum.attribute("sycho-github-milestone.repository"))?void 0:s.split("/")[1]},milestone:o().forum.attribute("sycho-github-milestone.milestone_id")},this.settings.repository.owner&&this.settings.repository.name&&this.settings.milestone?this.state.refresh().then((()=>{this.milestone=o().store.all("github-milestones")[0]})):m.route.set("/")}view(){return m(N(),{loading:this.state.isLoading(),className:"MilestonePage",sidebar:()=>m(i(),null),hero:()=>m(W,{title:this.milestone.title(),subtitle:[m("div",{className:"GithubMilestone-details"},p()(this.milestoneDetails().toArray())),m(V(),{fancy:!0,alternate:!0,progress:this.progress()})]})},this.state.isLoading()?m(I(),null):m(Q,{state:this.state,milestone:this.milestone,activeState:this.activeState}))}milestoneDetails(){const t=new(y());return t.add("updatedAt",m("div",{className:"GithubMilestone-detailsItem"},m("strong",null,m(A(),{name:"fas fa-clock"}))," ",o().translator.trans("sycho-github-milestone.forum.last_updated",{time:M()(this.milestone.updatedAt())}))),t.add("openIssues",m("div",{className:"GithubMilestone-detailsItem"},m("strong",null,this.milestone.openIssues())," ",o().translator.trans("sycho-github-milestone.forum.open"))),t.add("closedIssues",m("div",{className:"GithubMilestone-detailsItem"},m("strong",null,this.milestone.closedIssues())," ",o().translator.trans("sycho-github-milestone.forum.closed"))),t.add("progress",m("div",{className:"GithubMilestone-detailsItem"},o().translator.trans("sycho-github-milestone.forum.complete",{progress:this.progress()}))),t}progress(){return this.milestone?Math.round(100*this.milestone.closedIssues()/(this.milestone.closedIssues()+this.milestone.openIssues())):0}}flarum.reg.add("sycho-github-milestone","forum/components/MilestonePage",et);const st=flarum.reg.get("core","common/Model");var ot=t.n(st);class at extends(ot()){constructor(){super(...arguments),d(this,"htmlUrl",ot().attribute("htmlUrl")),d(this,"title",ot().attribute("title")),d(this,"body",ot().attribute("body")),d(this,"state",ot().attribute("state")),d(this,"stateReason",ot().attribute("stateReason")),d(this,"createdAt",ot().attribute("createdAt",ot().transformDate)),d(this,"updatedAt",ot().attribute("updatedAt",ot().transformDate)),d(this,"comments",ot().attribute("comments")),d(this,"pullRequest",ot().attribute("pullRequest")),d(this,"user",ot().attribute("user")),d(this,"labels",ot().attribute("labels")),d(this,"milestone",ot().hasOne("milestone"))}}flarum.reg.add("sycho-github-milestone","forum/models/Issue",at);class it extends(ot()){constructor(){super(...arguments),d(this,"htmlUrl",ot().attribute("htmlUrl")),d(this,"title",ot().attribute("title")),d(this,"state",ot().attribute("state")),d(this,"openIssues",ot().attribute("openIssues")),d(this,"closedIssues",ot().attribute("closedIssues")),d(this,"createdAt",ot().attribute("createdAt",ot().transformDate)),d(this,"updatedAt",ot().attribute("updatedAt",ot().transformDate)),d(this,"dueOn",ot().attribute("dueOn",ot().transformDate)),d(this,"closedAt",ot().attribute("closedAt",ot().transformDate))}}flarum.reg.add("sycho-github-milestone","forum/models/Milestone",it);const rt=[(new(c().Routes)).add("githubMilestone","/milestone",et),(new(c().Store)).add("github-issues",at).add("github-milestones",it)];o().initializers.add("sycho-github-milestone",(t=>{const e=t.data.resources[0].attributes["sycho-github-milestone.repository"],s=t.data.resources[0].attributes["sycho-github-milestone.milestone_id"];e&&s&&(0,r.extend)(i().prototype,"navItems",(e=>(e.add("githubMilestone",m(l(),{href:t.route("githubMilestone"),icon:"fab fa-github-alt"},t.translator.trans("sycho-github-milestone.forum.title")),100),e)))}))})(),module.exports=e})();
//# sourceMappingURL=forum.js.map